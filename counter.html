<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.8.1/firebase.js"></script>
    <title>Document</title>
</head>

<body>
    <h1 id="postsfor3846">text1</h1>
    <h1 id="postsfor3785">text2</h1>
    <!-- there should be no posts for pub666 thought it would be coold to have a mark of the beast pub  -->
    <h1 id="postsfor666">text2</h1>
    <script>

        // there has to be better ways of doing this but i got this to work 
        //
        var postCount = []; // this looks like an array but actually has a string in it
        var numtest = 0;
        var config = {
            apiKey: "redact",
            authDomain: "test-ed6f8.firebaseapp.com",
            databaseURL: "https://test-ed6f8.firebaseio.com",
            projectId: "test-ed6f8",
            storageBucket: "test-ed6f8.appspot.com",
            messagingSenderId: "609445629844"
        };
        firebase.initializeApp(config);

        database = firebase.database();
        getCounts();
        setTimeout(function () {  // this is cheating, it shoudl be a promise but Shawn said 
            //we would not get marked down for doing this this cheasy way
            showCounts();
        }, 1500); // how low can this safely go?  TEST on their network to see

        function getCounts() {
            database.ref().on("child_added", function (childSnapshot) {
                thisPub = childSnapshot.val().pubID;
                if (typeof (postCount[thisPub]) == "undefined")
                    postCount[thisPub] = 0;

                postCount[thisPub] = postCount[thisPub] + 1;
            });
        }
        function showCounts() {
            var postIDX;
            var txt;
            var numPosts = 0;
            // put jquery stuff in here to show number of posts
            //  we loop thru (for each) all h1's filtering out 
            // only those beggining with "postsfor"  the ^ means begins with in JS regular expressions
            $('h1').filter(function () {
                return /^postsfor/.test(this.id);
            }).each(function () {
                // set txt to an array consisting of each \d (numbers) in the string
                txt = this.id.match(/\d/g);
                postIDX = txt.join("");
                numPosts = postCount[postIDX];
                // pubs with no posts returns undefined
                // because the associative array was enver defined for them
                if (typeof(numPosts) == "undefined")
                numPosts = 0;
                $("#postsfor" + postIDX).html(numPosts);
            });

        }
    </script>
</body>

</html>
